<?xml version="1.0" encoding="UTF-8"?><record_update table="sys_ui_script">
    <sys_ui_script action="INSERT_OR_UPDATE">
        <active>true</active>
        <description/>
        <global>false</global>
        <name>x_snc_formmods.Service.FmUpload</name>
        <script><![CDATA[FmUtil.service('FmUpload', function FmUpload ($http, $q, $window) {
	
	'use strict';

	var attachmentGuid;
	var tableName;
	
	return {
		upload: upload,
		init: init
	};

	function init(table, sysId) {
		attachmentGuid = sysId;
		tableName = table;
	}

	function upload(files) {

		return $q(function (success, failure) {

			Array.prototype.forEach.call(files, function(file) {

				var fd = new $window.FormData();
				fd.append('attachments_modified', true);
				fd.append('sysparm_table', tableName);
				fd.append('sysparm_sys_id', attachmentGuid);
				fd.append('sysparm_nostack', 'yes');
				fd.append('sysparm_encryption_context', '');
				fd.append('sysparm_ck', $window.g_ck);
				fd.append('attachFile', file);

				$http.post('/angular.do', fd, {
					transformRequest: $window.angular.identity,
					params: {
						'sysparm_type': 'ngk_attachments',
						'table': tableName,
						'sys_id': attachmentGuid,
						'action': 'add'
					},
					headers: {
						'X-UserToken' : $window.g_ck,
						'Content-Type': undefined
					}
				}).then(function (response) {
					success(response);
				});

			});

		});
	}
});
]]></script>
        <script_name>Service.FmUpload</script_name>
        <sys_class_name>sys_ui_script</sys_class_name>
        <sys_created_by>james.tandy@snc</sys_created_by>
        <sys_created_on>2018-10-17 05:40:11</sys_created_on>
        <sys_id>8c4a694cdbdda3005f2cf2353a9619e2</sys_id>
        <sys_mod_count>1</sys_mod_count>
        <sys_name>x_snc_formmods.Service.FmUpload</sys_name>
        <sys_package display_value="formmods" source="x_snc_formmods">c94633a3db81a300a8e68a8b3a961980</sys_package>
        <sys_policy/>
        <sys_scope display_value="formmods">c94633a3db81a300a8e68a8b3a961980</sys_scope>
        <sys_update_name>sys_ui_script_8c4a694cdbdda3005f2cf2353a9619e2</sys_update_name>
        <sys_updated_by>james.tandy@snc</sys_updated_by>
        <sys_updated_on>2018-10-17 05:40:26</sys_updated_on>
        <ui_type>1</ui_type>
        <use_scoped_format>false</use_scoped_format>
    </sys_ui_script>
</record_update>
